import{a as i,b as T,j as e,M as w,r as a}from"./app-DLDUMbf_.js";import{S as P}from"./react-select.esm-Dm3pxJ3l.js";import{A as S}from"./AuthenticatedLayout-DISThC0w.js";import"./NavLink-_jzZh8Kt.js";import"./index-5Q2pxwOT.js";const k=({transaction:l,collectors:z,latest:p})=>{const[B,b]=i.useState(""),[c,u]=i.useState(l.partial??0),[g,h]=i.useState(0),[x,v]=i.useState(0),{data:r,setData:n,patch:N,errors:y,reset:j,processing:I}=T({id:l.id,customer_id:l.customer_plan.customer.id,collector_id:l.customer_plan.collector.id,customer_plan_id:l.customer_plan_id,bill_no:l.bill_no,rebate:l.rebate,partial:l.partial,bill_amount:l.bill_amount,remarks:l.remarks,date_billing:l.date_billing,status:l.status}),d=[{value:"paid",label:"Paid"},{value:"unpaid",label:"Unpaid"}];console.log("Waw",JSON.stringify(l,null,2)),i.useEffect(()=>{const s=Number(l.customer_plan.plan.plan_price)||0,t=Number(r.rebate||0),o=Number(c||0),m=s-t;h(m);const f=m-o;v(f),n("bill_amount",m)},[r.rebate,c,l.customer_plan.plan.plan_price]);const _=async s=>{s.preventDefault(),console.log("Form Dataee:",JSON.stringify(r,null,2)),await N(route("transactions.update",r.id),{onSuccess:()=>{alert("Transaction updated successfully!"),window.location.reload(),j()},onError:t=>{console.log(t)}})};return e.jsxs(S,{children:[e.jsx(w,{title:"Billing Transactions"}),e.jsx("div",{className:"flex justify-center overflow-y-auto max-h-[590px]",children:e.jsx("div",{className:"mb-10 w-full lg:w-[45%] p-4 overflow-auto shadow-md rounded-md border-2 border-sky-500 ",children:e.jsxs("form",{onSubmit:_,children:[e.jsx("input",{type:"hidden",value:r.collector_id,onChange:s=>n("collector_id",s.target.value),className:"mb-2"}),e.jsxs("div",{className:"mb-1",children:[e.jsx(a.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Customer Name"}),e.jsx(a.Input,{size:"md",value:`${l.customer_plan.customer.firstname} ${l.customer_plan.customer.lastname}`,disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(a.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Acc No."}),e.jsx(a.Input,{size:"md",value:r.customer_id,disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(a.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Bill No."}),e.jsx(a.Input,{size:"md",value:r.bill_no,disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(a.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Bill Amount"}),e.jsx(a.Input,{size:"md",value:l.customer_plan.plan.plan_price,disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(a.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Outstanding Balance Previous Month"}),e.jsx(a.Input,{size:"md",value:p.balance??0,disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(a.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Rebate"}),e.jsx(a.Input,{type:"number",size:"md",value:r.rebate??0,onChange:s=>{const t=Number(s.target.value),o=Number(l.customer_plan.plan.plan_price);t>o?(alert(`Rebate cannot be greater than Plan Price (${o}).`),n("rebate",o)):n("rebate",t),b(t)},className:"mb-3",onWheel:s=>s.target.blur()})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(a.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Total Amount Due"}),e.jsx(a.Input,{type:"number",size:"md",value:g,className:"mb-3",disabled:!0})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(a.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Payment"}),e.jsx(a.Input,{type:"number",size:"md",value:r.partial??0,onChange:s=>{const t=Number(s.target.value),o=Number(l.customer_plan.plan.plan_price)-Number(r.rebate||0);t>o?(alert(`Partial cannot be greater than Total Amount Paid (${o}).`),n("partial",o),u(o)):(n("partial",t),u(t))},className:"mb-3",onWheel:s=>s.target.blur()})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(a.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Outstanding Balance"}),e.jsx(a.Input,{size:"md",value:x,disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(a.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Date Billing"}),e.jsx(a.Input,{size:"md",disabled:!0,type:"date",value:r.date_billing,onChange:s=>n("date_billing",s.target.value),error:!!y.date_billing,className:"w-full"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(a.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Status"}),e.jsx(P,{options:d,placeholder:"Choose a status",value:d.find(s=>s.value===r.status),onChange:s=>n("status",s?s.value:""),className:"mb-3"})]}),e.jsx(a.Button,{type:"submit",color:"blue",fullWidth:!0,children:"Update"}),e.jsx("a",{href:`/admin/transactions/print/${l.id}`,target:"_blank",rel:"noopener noreferrer",className:"mt-4 inline-block w-full rounded-lg bg-gradient-to-r from-green-600 to-green-400 px-4 py-2 text-center font-semibold text-white shadow-md hover:from-green-700 hover:to-green-500 focus:outline-none focus:ring-2 focus:ring-green-300",children:"Print"})]})})})]})};export{k as default};
