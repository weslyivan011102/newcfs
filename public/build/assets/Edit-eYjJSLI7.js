import{a as u,b as I,j as a,M as B,r as l}from"./app-BdyLqLlc.js";import{S as p}from"./react-select.esm-DN-vpcAI.js";import{A}from"./AuthenticatedLayout-C8D8eUzt.js";import"./NavLink-BvgaK94k.js";import"./index-B7gYL_ii.js";const D=({transaction:s,collectors:P,latest:v})=>{const[m,d]=u.useState(s.partial??0),[g,x]=u.useState(0),[j,y]=u.useState(0),{data:r,setData:i,patch:N,errors:_,reset:L,processing:C}=I({id:s.id,customer_id:s.customer_plan.customer.id,collector_id:s.customer_plan.collector.id,customer_plan_id:s.customer_plan_id,bill_no:s.bill_no,rebate:s.rebate,partial:s.partial,bill_amount:s.bill_amount,description:s.description,mode_payment:s.mode_payment,remarks:s.remarks,date_billing:s.date_billing,status:s.status}),c=[{value:"Paid",label:"Paid"},{value:"Unpaid",label:"Unpaid"}],b=[{value:"N/A",label:"N/A"},{value:"Cash",label:"Cash"},{value:"Gcash",label:"Gcash"},{value:"Cheque",label:"Cheque"}],h=[{value:"n/a",label:"SELECT MONTH"},{value:"january",label:"JAN BILL"},{value:"february",label:"FEB BILL"},{value:"march",label:"MARCH BILL"},{value:"april",label:"APRIL BILL"},{value:"may",label:"MAY BILL"},{value:"june",label:"JUNE BILL"},{value:"july",label:"JULY BILL"},{value:"august",label:"AUG BILL"},{value:"september",label:"SEPT BILL"},{value:"october",label:"OCT BILL"},{value:"november",label:"NOV BILL"},{value:"december",label:"DEC BILL"}];u.useEffect(()=>{const e=Number(s.customer_plan.plan.plan_price)||0,t=Number(r.rebate||0),n=Number(m||0),o=e-t;x(o);const T=o-n;y(T),i("bill_amount",o)},[r.rebate,m,s.customer_plan.plan.plan_price]);const f=async e=>{e.preventDefault(),await N(route("transactions.update",r.id),{onSuccess:()=>{alert("Transaction updated successfully!"),window.location.reload(),L()},onError:t=>console.log(t)})};return a.jsxs(A,{children:[a.jsx(B,{title:"Billing Transactions"}),a.jsx("div",{className:"flex justify-center overflow-y-auto max-h-[590px]",children:a.jsx("div",{className:"mb-10 w-full lg:w-[45%] p-4 overflow-auto shadow-md rounded-md border-2 border-sky-500 ",children:a.jsxs("form",{onSubmit:f,children:[a.jsxs("div",{className:"mb-1",children:[a.jsx(l.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1",children:"Customer Name"}),a.jsx(l.Input,{size:"md",value:`${s.customer_plan.customer.firstname} ${s.customer_plan.customer.lastname}`,disabled:!0})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(l.Typography,{variant:"paragraph",className:"mb-1",children:"Acc No."}),a.jsx(l.Input,{size:"md",value:r.customer_id,disabled:!0})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(l.Typography,{variant:"paragraph",className:"mb-1",children:"Bill No."}),a.jsx(l.Input,{size:"md",value:r.bill_no,disabled:!0})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(l.Typography,{variant:"paragraph",className:"mb-1",children:"Bill Amount"}),a.jsx(l.Input,{size:"md",value:s.customer_plan.plan.plan_price,disabled:!0})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(l.Typography,{variant:"paragraph",className:"mb-1",children:"Outstanding Balance Previous Month"}),a.jsx(l.Input,{size:"md",value:v.balance??0,disabled:!0})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(l.Typography,{variant:"paragraph",className:"mb-1",children:"Rebate"}),a.jsx(l.Input,{type:"number",value:r.rebate??0,onChange:e=>{const t=Number(e.target.value),n=Number(s.customer_plan.plan.plan_price);t>n?(alert(`Rebate cannot exceed Plan Price (${n}).`),i("rebate",n)):i("rebate",t)},onWheel:e=>e.target.blur()})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(l.Typography,{variant:"paragraph",className:"mb-1",children:"Total Amount Due"}),a.jsx(l.Input,{value:g,disabled:!0})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(l.Typography,{variant:"paragraph",className:"mb-1",children:"Payment"}),a.jsx(l.Input,{type:"number",value:r.partial??0,onChange:e=>{const t=Number(e.target.value),n=Number(s.customer_plan.plan.plan_price)-Number(r.rebate||0);t>n?(alert(`Partial cannot exceed Total Amount Due (${n}).`),i("partial",n),d(n)):(i("partial",t),d(t))},onWheel:e=>e.target.blur()})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(l.Typography,{variant:"paragraph",className:"mb-1",children:"Outstanding Balance"}),a.jsx(l.Input,{value:j,disabled:!0})]}),a.jsxs("div",{className:"mb-3",children:[a.jsx(l.Typography,{variant:"paragraph",className:"mb-1",children:"Date Billing"}),a.jsx(l.Input,{type:"date",value:r.date_billing,onChange:e=>i("date_billing",e.target.value),error:!!_.date_billing})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(l.Typography,{variant:"paragraph",className:"mb-1",children:"Description"}),a.jsx(p,{options:h,value:h.find(e=>e.value===r.description),onChange:e=>i("description",(e==null?void 0:e.value)||"n/a")})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(l.Typography,{variant:"paragraph",className:"mb-1",children:"Payment Mode"}),a.jsx(p,{options:b,value:b.find(e=>e.value===r.mode_payment),onChange:e=>i("mode_payment",(e==null?void 0:e.value)||"N/A")})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(l.Typography,{variant:"paragraph",className:"mb-1",children:"Status"}),a.jsx(p,{options:c,value:c.find(e=>e.value===r.status),onChange:e=>i("status",(e==null?void 0:e.value)||"")})]}),a.jsx(l.Button,{type:"submit",color:"blue",fullWidth:!0,children:"Update"}),a.jsx("a",{href:`/admin/transactions/print/${s.id}`,target:"_blank",className:"mt-4 inline-block w-full rounded-lg bg-green-600 px-4 py-2 text-center text-white font-semibold shadow-md hover:bg-green-700",children:"Print"})]})})})]})};export{D as default};
