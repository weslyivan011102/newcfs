import{a as r,j as e,M as X,r as a,c as U}from"./app-BdyLqLlc.js";import{A as Z}from"./AuthenticatedLayout-C8D8eUzt.js";import{l as ee}from"./index-BzPIjsZP.js";import{U as te}from"./UseAppUrl-CjQRC-du.js";import"./NavLink-BvgaK94k.js";import"./index-B7gYL_ii.js";const oe=()=>{const S=te(),[D,M]=r.useState(null),[w,G]=r.useState("asc"),[g,Y]=r.useState(""),[m,q]=r.useState(new Date().getMonth()+1),[x,K]=r.useState(new Date().getFullYear()),[j,B]=r.useState([]),[y,O]=r.useState(!1),[C,V]=r.useState(""),[_,v]=r.useState(null),[P,N]=r.useState(!1),$=r.useRef(),W=ee.useReactToPrint({contentRef:$}),z=t=>{const l=D===t&&w==="asc"?"desc":"asc";M(t),G(l);const h=[...j].sort((b,f)=>{const n=s=>{var i,u,d,p,k,T,E,L,R,A,F,I;switch(t){case"bill_no":return s.bill_no??0;case"customer_no":return((i=s.customer_plan.customer)==null?void 0:i.id)??0;case"customer_name":return`${((u=s.customer_plan.customer)==null?void 0:u.firstname)??""} ${((d=s.customer_plan.customer)==null?void 0:d.lastname)??""}`.toLowerCase();case"address":return`${((T=(k=(p=s.customer_plan.customer)==null?void 0:p.purok)==null?void 0:k.barangay)==null?void 0:T.barangay_name)??""} ${((A=(R=(L=(E=s.customer_plan.customer)==null?void 0:E.purok)==null?void 0:L.barangay)==null?void 0:R.municipality)==null?void 0:A.municipality_name)??""}`.toLowerCase();case"mbps":return((F=s.customer_plan.plan)==null?void 0:F.mbps)??0;case"plan_price":return((I=s.customer_plan.plan)==null?void 0:I.plan_price)??0;case"previous_balance":return s.balance??0;case"total_due":return s.outstanding_balance??0;case"remarks":return(s.remarks||"").toLowerCase();default:return""}};let c=n(b),o=n(f);return c<o?l==="asc"?-1:1:c>o?l==="asc"?1:-1:0});B(h)},H=t=>D!==t?"↕":w==="asc"?"↑":"↓",J=async()=>{if(!g||!m||!x)return alert("Please select all filters!");try{O(!0);const t=await U.get(`${S}/api/batch-unpaid/${g}?month=${m}&year=${x}`);B(t.data.transactions||[])}catch(t){console.error("Error fetching unpaid transactions:",t)}finally{O(!1)}},Q=async()=>{if(!C)return alert("Please select a batch!");try{N(!0),v(null);const t=await U.post(`${S}/api/batch-billing/generate/${C}`);setTimeout(()=>{v(t.data),N(!1)},5e3)}catch(t){console.error("Error generating batch:",t),N(!1)}};return r.useEffect(()=>{if(_){const t=setTimeout(()=>{v(null),window.location.reload()},3e3);return()=>clearTimeout(t)}},[_]),e.jsxs(Z,{children:[e.jsx(X,{title:"CFS INTERNET NETWORK SOLUTIONS"}),e.jsx("div",{className:"flex justify-end items-center mb-2",children:e.jsx(a.Button,{color:"green",onClick:W,children:"Print"})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h1",{className:"text-4xl mt-1 mb-5",children:"Batch Billing Generation"}),e.jsxs("div",{className:"max-w-[800px] mb-4",children:[e.jsxs("h3",{children:["Generate Batch Billing for the month"," ",new Date().toLocaleDateString("en-US",{month:"long",year:"numeric"})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsxs(a.Select,{label:"Select Due",onChange:t=>V(t),children:[e.jsx(a.Option,{value:"1",children:"Due1"}),e.jsx(a.Option,{value:"2",children:"Due5"}),e.jsx(a.Option,{value:"3",children:"Due10"}),e.jsx(a.Option,{value:"4",children:"Due15"}),e.jsx(a.Option,{value:"5",children:"Due25"}),e.jsx(a.Option,{value:"6",children:"Due28-AllCheque"})]}),e.jsx(a.Button,{onClick:Q,disabled:P,children:P?"Generating...":"Generate"})]})]}),_&&e.jsx("div",{className:"mt-6 p-4 bg-green-200 rounded-md w-full text-center text-green-800",children:e.jsx(a.Typography,{variant:"h6",children:"Batch bill generated successfully."})}),e.jsxs("div",{className:"max-w-[920px] w-full border-t border-gray-300 mt-2 flex gap-4 p-2",children:[e.jsxs(a.Select,{label:"Select Due",onChange:t=>Y(t),children:[e.jsx(a.Option,{value:"1",children:"Due1"}),e.jsx(a.Option,{value:"2",children:"Due5"}),e.jsx(a.Option,{value:"3",children:"Due10"}),e.jsx(a.Option,{value:"4",children:"Due15"}),e.jsx(a.Option,{value:"5",children:"Due25"}),e.jsx(a.Option,{value:"6",children:"Due28-AllCheque"})]}),e.jsx(a.Input,{type:"number",label:"Month",value:m,onChange:t=>q(t.target.value),min:1,max:12}),e.jsx(a.Input,{type:"number",label:"Year",value:x,onChange:t=>K(t.target.value),min:2e3,max:2100}),e.jsx(a.Button,{onClick:J,disabled:y,children:y?"Fetching...":"Filter"})]})]}),e.jsx("div",{className:"px-1 mt-2 h-[350px] overflow-auto",children:e.jsxs("div",{ref:$,className:"print:px-2",children:[e.jsx("div",{className:"flex flex-col items-center mb-4 mt-4",children:e.jsxs("h3",{className:"text-sm",children:["Batch ",g??""," (",m??"","/",x??"",")"]})}),e.jsxs("table",{className:"w-full text-left border border-gray-300 text-xs text-gray-800",children:[e.jsx("thead",{children:e.jsx("tr",{children:[{field:"bill_no",label:"Bill No"},{field:"customer_no",label:"Customer No."},{field:"customer_name",label:"Customer Name"},{field:"address",label:"Address"},{field:"mbps",label:"Mbps"},{field:"plan_price",label:"Plan Price"},{field:"previous_balance",label:"Previous Balance"},{field:"total_due",label:"Total Amount Due"},{field:"remarks",label:"Remarks"}].map(t=>e.jsxs("th",{onClick:()=>z(t.field),className:"cursor-pointer px-2 py-3 bg-gray-300 border",children:[t.label," ",H(t.field)]},t.field))})}),e.jsx("tbody",{children:j.length>0?j.map(t=>{var l,h,b,f,n,c,o,s,i,u,d,p;return e.jsxs("tr",{className:"hover:bg-blue-gray-50",children:[e.jsx("td",{className:"border px-1 py-1 text-[10px]",children:t.bill_no}),e.jsx("td",{className:"border px-1 py-1 text-[10px]",children:(l=t.customer_plan.customer)==null?void 0:l.id}),e.jsx("td",{className:"border px-1 py-1 text-[10px]",children:`${(h=t.customer_plan.customer)==null?void 0:h.firstname} ${(b=t.customer_plan.customer)==null?void 0:b.lastname}`}),e.jsxs("td",{className:"border px-1 py-1 text-[10px]",children:[(c=(n=(f=t.customer_plan.customer)==null?void 0:f.purok)==null?void 0:n.barangay)==null?void 0:c.barangay_name,","," ",(u=(i=(s=(o=t.customer_plan.customer)==null?void 0:o.purok)==null?void 0:s.barangay)==null?void 0:i.municipality)==null?void 0:u.municipality_name]}),e.jsxs("td",{className:"border px-1 py-1 text-[10px]",children:[(d=t.customer_plan.plan)==null?void 0:d.mbps," mbps"]}),e.jsxs("td",{className:"border px-1 py-1 text-[10px]",children:["₱",(p=t.customer_plan.plan)==null?void 0:p.plan_price]}),e.jsxs("td",{className:"border px-1 py-1 text-[10px]",children:["₱",t.balance??0]}),e.jsxs("td",{className:"border px-1 py-1 text-[10px]",children:["₱",t.outstanding_balance??0]}),e.jsx("td",{className:"border px-1 py-1 text-[10px]"})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"text-center px-1 py-1 text-[8px]",children:y?"Fetching data...":"No records found"})})})]})]})})]})};export{oe as default};
