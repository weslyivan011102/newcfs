import{a as c,V,j as e,M as K,r as a,U as j,c as L}from"./app-BdyLqLlc.js";import{C as W}from"./index-CKdL8VZm.js";import{d as B,A as G,a as X}from"./index-B7gYL_ii.js";import{A as Z}from"./AuthenticatedLayout-C8D8eUzt.js";import{u as ee}from"./useQuery-A8Dbsqml.js";import{P as re}from"./Pagination-BeA_-QfI.js";import{U as ae}from"./UseAppUrl-CjQRC-du.js";import{f as se}from"./format-BzRktsyD.js";import"./NavLink-BvgaK94k.js";const A=["Bill NO.","Customer Name","Mbps Plan","Description","Payment Mode","Payment","Total Amount Due","Date Billing","Payment Date","Status","Actions"],ge=()=>{const C=ae(),[S,M]=c.useState(""),N=new Date,[m,T]=c.useState(N.getMonth()+1),[d,P]=c.useState(N.getFullYear()),t=r=>{F(l=>({column:r,direction:l.column===r&&l.direction==="asc"?"desc":"asc"}))},n=({column:r})=>i.column!==r?e.jsx("span",{children:"↕"}):i.direction==="asc"?e.jsx("span",{children:"▲"}):e.jsx("span",{children:"▼"}),I=["January","February","March","April","May","June","July","August","September","October","November","December"],O={"n/a":"N/A",january:"JAN BILL",february:"FEB BILL",march:"MAR BILL",april:"APR BILL",may:"MAY BILL",june:"JUN BILL",july:"JUL BILL",august:"AUG BILL",september:"SEP BILL",october:"OCT BILL",november:"NOV BILL",december:"DEC BILL"},k=async({queryKey:r})=>{const[l,o,p,u,g,D,y,b]=r;return(await L.get(`${C}/api/get_transactions`,{params:{page:o,search:p,sortColumn:u,sortDirection:g,batch:D,month:y,year:b}})).data},{batch_bills:x}=V().props,[f,E]=c.useState(""),[h,v]=c.useState((x==null?void 0:x.current_page)||1),[i,F]=c.useState({column:"",direction:"desc"}),{data:s,error:te,isLoading:U,refetch:R}=ee({queryKey:["batch_bills",h,f,i.column,i.direction,S,m,d],queryFn:k,keepPreviousData:!0}),_=(s==null?void 0:s.data.map(r=>({id:r.id,bill_no:r.bill_no,customer_name:`${r.customer_plan.customer.lastname} ${r.customer_plan.customer.firstname} ${r.customer_plan.middlename??""}`,mbps:r.customer_plan.plan.mbps,plan_price:r.customer_plan.plan.plan_price,amount:r.bill_amount,date_billing:r.date_billing,description:O[r.description]||r.description,mode_payment:r.mode_payment,remarks:r.remarks,partial:r.partial,batch:r.customer_plan.date_billing,status:r.status,payment_date:r.created_at})))||[],q=r=>{const l=r.target.value;E(l),l||v(1)},J=r=>{v(r)},$=async r=>{if(window.confirm("Are you sure you want to delete this bill transaction?"))try{const o=await L.delete(`/admin/transactions/${r}`);alert(o.data.message),R()}catch(o){console.error(o),alert("An unexpected error occurred. Please try again later.")}},H=r=>({batch1:"Due1",batch2:"Due5",batch3:"Due10",batch4:"Due15",batch5:"Due25",all_cheque:"Due28-AllCheque"})[r]||r;return e.jsxs(Z,{children:[e.jsx(K,{title:"CFS INTERNET NETWORK SOLUTIONS"}),e.jsxs("div",{className:"bg-white overflow-y-auto max-h-[590px]",children:[e.jsxs("div",{className:"mt-5  px-4",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx(a.Typography,{variant:"lead",size:"small",className:"mb-0 text-lg font-bold",children:"Billing Transactions"}),e.jsx(a.Typography,{className:"text-sm",variant:"paragraph",size:"small",children:"Manage bills transactions"})]}),e.jsxs("nav",{className:"flex items-center space-x-1 text-gray-600 text-sm mt-3",children:[e.jsx("a",{href:"/admin/transactions",className:"font-bold text-blue-800",children:"Batch"}),e.jsx(B,{className:"w-4 h-4"}),e.jsx("a",{href:"/admin/transactions-advance",className:"hover:text-black",children:"Advance"}),e.jsx(B,{className:"w-4 h-4"})]})]}),e.jsxs("div",{children:[e.jsxs("p",{children:["Month: ",I[m-1]]})," ",e.jsxs("p",{children:["Year: ",d]})]})]}),e.jsxs("div",{className:"flex gap-4 mt-4 mb-3",children:[e.jsx("div",{className:"min-w-[160px]",children:e.jsxs(a.Select,{label:"Select Due",onChange:r=>M(r),children:[e.jsx(a.Option,{value:"batch1",children:"Due1"}),e.jsx(a.Option,{value:"batch2",children:"Due5"}),e.jsx(a.Option,{value:"batch3",children:"Due10"}),e.jsx(a.Option,{value:"batch4",children:"Due15"}),e.jsx(a.Option,{value:"batch5",children:"Due25"}),e.jsx(a.Option,{value:"all_cheque",children:"Due28-AllCheque"})]})}),e.jsx("div",{className:"min-w-[100px]",children:e.jsx(a.Input,{type:"number",label:"Month",min:1,max:12,value:m,onChange:r=>T(r.target.value)})}),e.jsx("div",{className:"min-w-[120px]",children:e.jsx(a.Input,{type:"number",label:"Year",min:2e3,max:2100,value:d,onChange:r=>P(r.target.value)})}),e.jsx(a.Button,{className:"px-6",onClick:()=>window.location.reload(),children:"Reset"})]}),e.jsx("hr",{className:"border border-gray-300"}),e.jsxs("div",{className:"mt-5 w-full  flex items-center justify-between flex-col-reverse gap-2 lg:flex-row",children:[e.jsxs("div",{className:"relative w-96",children:[e.jsx("input",{className:"w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md pl-3 pr-10 py-2 transition duration-300 ease focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow",placeholder:"Search lastname...",value:f,onChange:q}),e.jsx(G,{className:"absolute top-1/2 right-3 -translate-y-1/2 text-slate-400"})]}),e.jsx("div",{children:e.jsx(j,{href:"/admin/transactions/create",children:e.jsxs(a.Button,{className:"flex gap-2 items-center",color:"blue",size:"md",children:[e.jsx(X,{className:"text-lg"}),"New Bill"]})})})]})]}),e.jsxs("div",{className:"flex-1  p-4  overflow-x-auto max-w-min md:max-w-full",children:[e.jsxs("table",{className:"w-full min-w-[350px] text-left  border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsxs("th",{onClick:()=>t("bill_no"),className:"cursor-pointer px-3 py-3 text-sm font-semibold bg-gray-300 text-gray-700 border border-gray-400",children:["Bill No. ",e.jsx(n,{column:"bill_no"})]}),e.jsxs("th",{onClick:()=>t("customer_name"),className:"cursor-pointer px-3 py-3 text-sm font-semibold bg-gray-300 text-gray-700 border border-gray-400",children:["Customer Name ",e.jsx(n,{column:"customer_name"})]}),e.jsxs("th",{onClick:()=>t("mbps"),className:"cursor-pointer px-3 py-3 text-sm font-semibold bg-gray-300 text-gray-700 border border-gray-400",children:["Mbps ",e.jsx(n,{column:"mbps"})]}),e.jsxs("th",{onClick:()=>t("description"),className:"cursor-pointer px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 border border-gray-400",children:["Description ",e.jsx(n,{column:"description"})]}),e.jsxs("th",{onClick:()=>t("mode_payment"),className:"cursor-pointer px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 border border-gray-400",children:["Payment Mode ",e.jsx(n,{column:"mode_payment"})]}),e.jsxs("th",{onClick:()=>t("partial"),className:"cursor-pointer px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 border border-gray-400",children:["Payment ",e.jsx(n,{column:"partial"})]}),e.jsxs("th",{onClick:()=>t("amount"),className:"cursor-pointer px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 border border-gray-400",children:["Total Amount Due ",e.jsx(n,{column:"amount"})]}),e.jsxs("th",{onClick:()=>t("date_billing"),className:"cursor-pointer px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 border border-gray-400",children:["Date Billing ",e.jsx(n,{column:"date_billing"})]}),e.jsxs("th",{onClick:()=>t("payment_date"),className:"cursor-pointer px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 border border-gray-400",children:["Payment Date ",e.jsx(n,{column:"payment_date"})]}),e.jsxs("th",{onClick:()=>t("status"),className:"cursor-pointer px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 border border-gray-400",children:["Status ",e.jsx(n,{column:"status"})]}),e.jsx("th",{className:" px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 border border-gray-400",children:"Action"})]})}),e.jsx("tbody",{children:U?e.jsx("tr",{children:e.jsx("td",{colSpan:A.length,className:"border border-blue-gray-100 p-4",children:e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(a.Spinner,{className:"h-10 w-10",color:"green"})})})}):_.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:A.length,className:"border border-blue-gray-100 p-4 text-center text-red-500",children:e.jsxs("div",{className:"flex justify-center items-center gap-2",children:["No bill records found",e.jsx(W,{className:"text-xl"})]})})}):_.map(({id:r,bill_no:l,customer_name:o,mbps:p,description:u,mode_payment:g,plan_price:D,partial:y,amount:b,remarks:w,status:Y,date_billing:ne,batch:z,date_registration:le,payment_date:Q})=>e.jsxs("tr",{className:"hover:bg-blue-gray-50 ",children:[e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsx(a.Typography,{variant:"small",className:"font-normal text-gray-800",children:l})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsx(a.Typography,{variant:"small",className:"font-normal text-gray-800",children:o})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsxs(a.Typography,{variant:"small",className:"font-normal text-gray-800",children:[p," mbps"]})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsx(a.Typography,{variant:"small",className:"font-normal text-gray-800",children:u})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsx(a.Typography,{variant:"small",className:"font-normal text-gray-800",children:g})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsxs(a.Typography,{variant:"small",className:"font-normal text-gray-800",children:["₱"," ",parseFloat(y).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsxs(a.Typography,{variant:"small",className:"font-normal text-gray-800",children:["₱"," ",parseFloat(b).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsx(a.Typography,{variant:"small",className:"font-normal text-gray-800",children:w==="batch"?H(z):""})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsx(a.Typography,{variant:"small",className:"font-normal text-gray-800",children:se(new Date(Q),"MM/dd/yyyy")})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsx(a.Typography,{variant:"small",className:"font-normal text-gray-800",children:Y})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsx("div",{className:"flex items-center gap-2 ",children:e.jsxs(a.Menu,{children:[e.jsx(a.MenuHandler,{children:e.jsx(a.IconButton,{variant:"text",children:e.jsx(a.Tooltip,{content:"Actions",children:e.jsx("img",{src:"/img/dots.png",alt:""})})})}),e.jsxs(a.MenuList,{children:[e.jsx(j,{className:"hover:bg-blue-800 hover:rounded hover:text-white",href:route("transactions.show",{id:r}),children:e.jsx(a.MenuItem,{children:"View"})}),e.jsx(j,{className:"hover:bg-blue-800 hover:rounded hover:text-white",href:route("transactions.edit",{id:r}),children:e.jsx(a.MenuItem,{children:"Edit"})}),e.jsx(a.MenuItem,{onClick:()=>$(r),children:e.jsx("span",{children:"Delete"})})]})]})})})]},r))})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center border-t border-blue-gray-50 p-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsxs(a.Typography,{variant:"small",color:"blue-gray",className:"font-normal",children:["Page ",s==null?void 0:s.current_page," of ",s==null?void 0:s.last_page]})}),e.jsxs("div",{className:"col-span-2 flex flex-col items-center",children:[e.jsx(re,{currentPage:(s==null?void 0:s.current_page)||1,lastPage:(s==null?void 0:s.last_page)||1,onPageChange:J}),e.jsxs("div",{className:"mt-3 text-gray-700",children:["Showing ",(h-1)*10+1," to"," ",Math.min(h*10,s==null?void 0:s.total)," of"," ",s==null?void 0:s.total," entries"]})]})]})]})]})]})};export{ge as default};
