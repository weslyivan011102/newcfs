import{a as t,j as e,M as U,r,c as C}from"./app-DLDUMbf_.js";import{A as I}from"./AuthenticatedLayout-DISThC0w.js";import{l as M}from"./index-CNWVK9_v.js";import{U as k}from"./UseAppUrl-CvaWbRTv.js";import"./NavLink-_jzZh8Kt.js";import"./index-5Q2pxwOT.js";const H=()=>{const p=k(),[n,P]=t.useState(""),[s,_]=t.useState(new Date().getMonth()+1),[l,E]=t.useState(new Date().getFullYear()),[m,R]=t.useState([]),[o,x]=t.useState(!1),[u,$]=t.useState(""),[c,i]=t.useState(null),[h,d]=t.useState(!1),A=async()=>{if(!n||!s||!l)return alert("Please select all filters!");try{x(!0);const a=await C.get(`${p}/api/batch-unpaid/${n}?month=${s}&year=${l}`);R(a.data.transactions||[])}catch(a){console.error("Error fetching unpaid transactions:",a)}finally{x(!1)}},g=t.useRef(),F=M.useReactToPrint({contentRef:g}),L=async()=>{if(!u)return alert("Please select a batch!");try{d(!0),i(null);const a=await C.post(`${p}/api/batch-billing/generate/${u}`);setTimeout(()=>{i(a.data),d(!1)},5e3)}catch(a){console.error("Error generating batch:",a),d(!1)}};return t.useEffect(()=>{if(c){const a=setTimeout(()=>{i(null),window.location.reload()},3e3);return()=>clearTimeout(a)}},[c]),e.jsxs(I,{children:[e.jsx(U,{title:"Generate Batch Bill"}),e.jsx("div",{className:"flex justify-end items-center ",children:e.jsx(r.Button,{variant:"gradient",className:"",color:"green",onClick:()=>F(),children:"Print"})}),e.jsxs("div",{className:"flex justify-center flex-col items-center",children:[e.jsx("h1",{className:"text-4xl mt-1 mb-5",children:"Batch Billing Generation"}),e.jsxs("div",{className:"max-w-[800px] mb-2",children:[e.jsxs("h3",{children:["Generate Batch Billing for the month"," ",new Date().toLocaleDateString("en-US",{month:"long",year:"numeric"})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsxs(r.Select,{label:"Select Due",onChange:a=>$(a),children:[e.jsx(r.Option,{value:"1",children:"Due1"}),e.jsx(r.Option,{value:"2",children:"Due5"}),e.jsx(r.Option,{value:"3",children:"Due10"}),e.jsx(r.Option,{value:"4",children:"Due15"}),e.jsx(r.Option,{value:"5",children:"Due25"}),e.jsx(r.Option,{value:"6",children:"Due28-AllCheque"})]}),e.jsx(r.Button,{onClick:L,disabled:h,children:h?"Generating...":"Generate"})]})]}),c&&e.jsx("div",{className:"mt-6 p-4 bg-green-200 rounded-md w-full text-center text-green-800",children:e.jsx(r.Typography,{variant:"h6",children:"Batch bill generated successfully."})}),e.jsx("div",{className:"max-w-[920px] w-full border-t border-gray-300 ",children:e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsxs(r.Select,{label:"Select Due",onChange:a=>P(a),children:[e.jsx(r.Option,{value:"1",children:"Due1"}),e.jsx(r.Option,{value:"2",children:"Due5"}),e.jsx(r.Option,{value:"3",children:"Due10"}),e.jsx(r.Option,{value:"4",children:"Due15"}),e.jsx(r.Option,{value:"5",children:"Due25"}),e.jsx(r.Option,{value:"6",children:"Due28-AllCheque"})]}),e.jsx(r.Input,{type:"number",label:"Month",value:s,onChange:a=>_(a.target.value),min:1,max:12}),e.jsx(r.Input,{type:"number",label:"Year",value:l,onChange:a=>E(a.target.value),min:2e3,max:2100}),e.jsx(r.Button,{onClick:A,disabled:o,children:o?"Fetching...":"Filter"})]})})]}),e.jsx("div",{className:"px-4 mt-5 h-[420px] overflow-auto",children:e.jsxs("div",{ref:g,className:"print:px-2",children:[e.jsxs("div",{className:"flex flex-col items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-bold",children:"CFS INTERNET NETWORK SOLUTION"}),e.jsxs("h3",{className:"text-lg",children:["Batch",n??"","(",s??"","/",l??""," )"]})]}),e.jsxs("table",{className:" w-full  text-left border border-gray-300 text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(r.Typography,{variant:"small",color:"blue-gray",className:"text-[12px] font-normal leading-none opacity-70",children:"Bill No"})}),e.jsx("th",{className:"px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(r.Typography,{variant:"small",color:"blue-gray",className:" text-[12px] font-normal leading-none opacity-70",children:"Customer No."})}),e.jsx("th",{className:"px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(r.Typography,{variant:"small",color:"blue-gray",className:"text-[12px] font-normal leading-none opacity-70",children:"Customer Name"})}),e.jsx("th",{className:"px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(r.Typography,{variant:"small",color:"blue-gray",className:"text-[12px] font-normal leading-none opacity-70",children:"Address"})}),e.jsx("th",{className:"px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(r.Typography,{variant:"small",color:"blue-gray",className:"text-[12px] font-normal leading-none opacity-70",children:"Mbps"})}),e.jsx("th",{className:"px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(r.Typography,{variant:"small",color:"blue-gray",className:"text-[12px] font-normal leading-none opacity-70",children:"Plan price"})}),e.jsx("th",{className:" w-[10%] px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(r.Typography,{variant:"small",color:"blue-gray",className:"text-[12px] font-normal leading-none opacity-70"})})]})}),e.jsx("tbody",{children:m.length>0?m.map(a=>{var b,y,j,f,N,v,D,T,B,S,O,w;return e.jsxs("tr",{className:"hover:bg-blue-gray-50",children:[e.jsx("td",{className:"border border-blue-gray-100 px-4 ",children:a.bill_no}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:(b=a.customer_plan.customer)==null?void 0:b.id}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:`${(y=a.customer_plan.customer)==null?void 0:y.firstname} ${(j=a.customer_plan.customer)==null?void 0:j.lastname}`}),e.jsxs("td",{className:"border border-blue-gray-100 px-4",children:[(v=(N=(f=a.customer_plan.customer)==null?void 0:f.purok)==null?void 0:N.barangay)==null?void 0:v.barangay_name,", ",(S=(B=(T=(D=a.customer_plan.customer)==null?void 0:D.purok)==null?void 0:T.barangay)==null?void 0:B.municipality)==null?void 0:S.municipality_name]}),e.jsxs("td",{className:"border border-blue-gray-100 px-4",children:[(O=a.customer_plan.plan)==null?void 0:O.mbps," mbps"]}),e.jsxs("td",{className:"border border-blue-gray-100 px-4",children:["â‚±",(w=a.customer_plan.plan)==null?void 0:w.plan_price]}),e.jsx("td",{className:"border border-blue-gray-100 px-4"})]},a.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4",children:o?"Fetching data...":"No records found"})})})]})]})})]})};export{H as default};
