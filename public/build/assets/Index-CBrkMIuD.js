import{a as n,V as R,c as m,j as e,M as q,r,U as w}from"./app-BdyLqLlc.js";import{C as Q}from"./index-CKdL8VZm.js";import{A as F}from"./index-B7gYL_ii.js";import{A as H}from"./AuthenticatedLayout-C8D8eUzt.js";import{u as K}from"./useQuery-A8Dbsqml.js";import{P as V}from"./Pagination-BeA_-QfI.js";import{U as W}from"./UseAppUrl-CjQRC-du.js";import"./NavLink-BvgaK94k.js";const A=["Acc No.","Customer Name","Sex","Marital Status","Address","Contact No.","Banned Date","Status",""],z={id:"Acc No.",customer_name:"Customer Name",sex:"Sex",marital_status:"Marital Status",address:"Address",contact_no:"Contact No.",banned_date:"Banned Date",status:"Status"},re=()=>{var C;const x=W(),[M,E]=n.useState([]),[$,N]=n.useState([]),[i,B]=n.useState(""),[f,v]=n.useState(""),{customers:p}=R().props,[S,P]=n.useState(""),[u,d]=n.useState((p==null?void 0:p.current_page)||1),[l,D]=n.useState({column:"",direction:"asc"});n.useEffect(()=>{m.get(`${x}/api/municipalities`).then(a=>E(a.data)).catch(a=>console.error("Error loading municipalities:",a))},[]),n.useEffect(()=>{i?m.get(`${x}/api/municipalities/${i}/barangays`).then(a=>N(a.data)).catch(a=>console.error("Error loading barangays:",a)):(N([]),v(""))},[i]);const I=async({queryKey:a})=>{const[t,c,o,g,j,b,y]=a;return(await m.get(`${x}/api/customer_banned`,{params:{page:c,lastname:o,sortColumn:g,sortDirection:j,municipality_id:b||"",barangay_id:y||""}})).data},{data:s,isLoading:L,refetch:T}=K({queryKey:["customers",u,S,l.column,l.direction,i,f],queryFn:I,keepPreviousData:!0}),h=a=>a?a.toLowerCase().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "):"",_=((C=s==null?void 0:s.data)==null?void 0:C.map(a=>{var t,c,o;return{id:a.id,customer_name:`${a.lastname} ${a.firstname} ${a.middlename??""}`,sex:a.sex,marital_status:a.marital_status??"",address:(o=(c=(t=a==null?void 0:a.purok)==null?void 0:t.barangay)==null?void 0:c.municipality)!=null&&o.municipality_name?`${h(a.purok.barangay.municipality.municipality_name)}, ${h(a.purok.barangay.barangay_name)}, ${h(a.purok.purok_name)}`:"—",contact_no:a.contact_no,banned_date:a.banned_date?new Date(a.banned_date).toLocaleDateString():"—",status:a.status}}))||[],U=a=>{P(a.target.value),d(1)},k=a=>d(a),O=async a=>{if(window.confirm("Delete this banned customer?"))try{const t=await m.delete(`/customers/${a}`);alert(t.data.message),T()}catch{alert("An unexpected error occurred.")}};return e.jsxs(H,{children:[e.jsx(q,{title:"CFS INTERNET NETWORK SOLUTIONS"}),e.jsxs("div",{className:"bg-white overflow-y-auto max-h-[590px]",children:[e.jsxs("div",{className:"mt-5 px-4",children:[e.jsx("div",{className:"mb-6 flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx(r.Typography,{className:"mb-0 text-lg font-bold",children:"Customer Banned"}),e.jsx(r.Typography,{className:"text-sm",children:"Manage customer banned"})]})}),e.jsxs("div",{className:"flex gap-4 mb-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Municipality"}),e.jsxs("select",{value:i,onChange:a=>{B(a.target.value),d(1)},className:"w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"-- Select Municipality --"}),M.map(a=>e.jsx("option",{value:a.id,children:a.municipality_name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Barangay"}),e.jsxs("select",{value:f,onChange:a=>{v(a.target.value),d(1)},className:"w-full border rounded-lg px-3 py-2",disabled:!i,children:[e.jsx("option",{value:"",children:"-- Select Barangay --"}),$.map(a=>e.jsx("option",{value:a.id,children:a.barangay_name},a.id))]})]})]}),e.jsxs("div",{className:"relative w-96",children:[e.jsx("input",{className:"w-full border rounded-md pl-3 pr-10 py-2",placeholder:"Search lastname...",value:S,onChange:U}),e.jsx(F,{className:"absolute top-1/2 right-3 -translate-y-1/2 text-slate-400"})]})]}),e.jsxs("div",{className:"flex-1 p-4 overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-left border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[Object.entries(z).map(([a,t])=>e.jsx("th",{onClick:()=>D({column:a,direction:l.column===a&&l.direction==="asc"?"desc":"asc"}),className:` px-6 py-3 text-xs  border-gray-300 text-gray-800 uppercase border
                               cursor-pointer  hover:bg-gray-200 select-none`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[t,e.jsx("span",{className:"text-xs",children:l.column===a?l.direction==="asc"?"▲":"▼":"↕"})]})},a)),e.jsx("th",{className:"px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:"Action"})]})}),e.jsx("tbody",{children:L?e.jsx("tr",{children:e.jsx("td",{colSpan:A.length,className:"p-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(r.Spinner,{className:"h-10 w-10",color:"green"})})})}):_.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:A.length,className:"p-4 text-center text-red-500",children:["No banned customer records found ",e.jsx(Q,{})]})}):_.map(({id:a,customer_name:t,sex:c,marital_status:o,address:g,contact_no:j,banned_date:b,status:y})=>e.jsxs("tr",{className:"hover:bg-blue-gray-50",children:[e.jsx("td",{className:"border text-sm px-2",children:a}),e.jsx("td",{className:"border text-sm px-2",children:t}),e.jsx("td",{className:"border text-sm px-2",children:c}),e.jsx("td",{className:"border text-sm px-2",children:o}),e.jsx("td",{className:"border text-sm px-2",children:g}),e.jsx("td",{className:"border text-sm px-2",children:j}),e.jsx("td",{className:"border text-sm px-2",children:b}),e.jsx("td",{className:"border text-sm px-2",children:y}),e.jsx("td",{className:"border text-sm px-2",children:e.jsxs(r.Menu,{children:[e.jsx(r.MenuHandler,{children:e.jsx(r.IconButton,{variant:"text",children:e.jsx(r.Tooltip,{content:"Actions",children:e.jsx("img",{src:"/img/dots.png"})})})}),e.jsxs(r.MenuList,{children:[e.jsx(w,{href:route("banned.show",{id:a}),children:e.jsx(r.MenuItem,{children:"View"})}),e.jsx(w,{href:route("banned.edit",{id:a}),children:e.jsx(r.MenuItem,{children:"Edit"})}),e.jsx(r.MenuItem,{onClick:()=>O(a),children:"Delete"})]})]})})]},a))})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center border-t p-4",children:[e.jsxs("div",{children:["Page ",s==null?void 0:s.current_page," of ",s==null?void 0:s.last_page]}),e.jsxs("div",{className:"col-span-2 flex flex-col items-center",children:[e.jsx(V,{currentPage:(s==null?void 0:s.current_page)||1,lastPage:(s==null?void 0:s.last_page)||1,onPageChange:k}),e.jsxs("div",{className:"mt-3 text-gray-700",children:["Showing ",(u-1)*10+1," to"," ",Math.min(u*10,s==null?void 0:s.total)," of"," ",s==null?void 0:s.total," entries"]})]})]})]})]})]})};export{re as default};
