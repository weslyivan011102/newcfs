import{a as r,V as R,c as m,j as e,M as q,r as n,U as N}from"./app-BdyLqLlc.js";import{C as Q}from"./index-CKdL8VZm.js";import{a as F,A as H}from"./index-B7gYL_ii.js";import{A as K}from"./AuthenticatedLayout-C8D8eUzt.js";import{u as V}from"./useQuery-A8Dbsqml.js";import{P as W}from"./Pagination-BeA_-QfI.js";import{U as z}from"./UseAppUrl-CjQRC-du.js";import"./NavLink-BvgaK94k.js";const b=["Acc No.","Customer Name","Sex","Address","contact no","disconnection date","Status",""],x={"Acc No.":"id","Customer Name":"customer_name",Sex:"sex",Address:"address",contact_no:"contact_no",disconnection:"disconnection",Status:"status"},re=()=>{const p=z(),[A,M]=r.useState([]),[E,v]=r.useState([]),[c,P]=r.useState(""),[S,_]=r.useState(""),{customers:u}=R().props,[C,I]=r.useState(""),[h,l]=r.useState((u==null?void 0:u.current_page)||1),[d,$]=r.useState({column:"",direction:"asc"});r.useEffect(()=>{m.get(`${p}/api/municipalities`).then(s=>M(s.data)).catch(s=>console.error("Error fetching municipalities:",s))},[]),r.useEffect(()=>{c?m.get(`${p}/api/municipalities/${c}/barangays`).then(s=>v(s.data)).catch(s=>console.error("Error fetching barangays:",s)):(v([]),_(""))},[c]);const B=async({queryKey:s})=>{const[a,o,i,j,y,f,O]=s;return(await m.get(`${p}/api/customer_disconnection`,{params:{page:o,lastname:i,sortColumn:j,sortDirection:y,municipality_id:f||"",barangay_id:O||""}})).data},{data:t,error:G,isLoading:T,refetch:k}=V({queryKey:["students",h,C,d.column,d.direction,c,S],queryFn:B,keepPreviousData:!0}),g=s=>s?s.toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" "):"",w=(t==null?void 0:t.data.map(s=>({id:s.id,customer_name:`${s.lastname} ${s.firstname} ${s.middlename??""}`,address:g(s.purok.barangay.municipality.municipality_name)+", "+g(s.purok.barangay.barangay_name)+", "+g(s.purok.purok_name),contact_no:s.contact_no,sex:s.sex,disconnection:s.disconnection,status:s.status})))||[],D=s=>{I(s.target.value),l(1)},L=s=>l(s),U=async s=>{if(window.confirm("Are you sure you want to delete this customer?"))try{const a=await m.delete(`/customers/${s}`);alert(a.data.message),k()}catch(a){console.error(a),alert("An unexpected error occurred.")}};return e.jsxs(K,{children:[e.jsx(q,{title:"CFS INTERNET NETWORK SOLUTIONS"}),e.jsxs("div",{className:"bg-white overflow-y-auto max-h-[590px]",children:[e.jsxs("div",{className:"mt-5 px-4",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(n.Typography,{variant:"lead",className:"text-lg font-bold",children:"Disconnection"}),e.jsx(n.Typography,{className:"text-sm",children:"Manage Disconnection"})]}),e.jsx(N,{href:"/disconnections/create",children:e.jsxs(n.Button,{className:"flex gap-2 items-center",color:"blue",size:"md",children:[e.jsx(F,{}),"Add Disconnection"]})})]}),e.jsxs("div",{className:"flex gap-4 mb-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Municipality"}),e.jsxs("select",{value:c,onChange:s=>{P(s.target.value),l(1)},className:"w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"-- Select Municipality --"}),A.map(s=>e.jsx("option",{value:s.id,children:s.municipality_name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Barangay"}),e.jsxs("select",{value:S,onChange:s=>{_(s.target.value),l(1)},className:"w-full border rounded-lg px-3 py-2",disabled:!c,children:[e.jsx("option",{value:"",children:"-- Select Barangay --"}),E.map(s=>e.jsx("option",{value:s.id,children:s.barangay_name},s.id))]})]})]}),e.jsx("div",{className:"w-full mb-5",children:e.jsxs("div",{className:"relative w-96",children:[e.jsx("input",{className:`w-full border rounded-md pl-3 pr-10 py-2
                        text-sm shadow-sm`,placeholder:"Search lastname...",value:C,onChange:D}),e.jsx(H,{className:"absolute top-1/2 right-3 -translate-y-1/2 text-slate-400"})]})})]}),e.jsxs("div",{className:"flex-1 p-4 overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-left border border-gray-300",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-100",children:b.map(s=>{const a=x[s],o=d.column===x[s];return e.jsx("th",{className:`
                                    px-6 py-3 text-xs  border-gray-300 text-gray-800 uppercase
                                    ${a?"cursor-pointer hover:bg-gray-200":""}
                                 `,onClick:()=>{a&&($(i=>({column:x[s],direction:i.column===x[s]&&i.direction==="asc"?"desc":"asc"})),l(1))},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),a&&e.jsx("span",{className:"text-xs",children:o?d.direction==="asc"?"▲":"▼":"↕"})]})},s)})})}),e.jsx("tbody",{children:T?e.jsx("tr",{children:e.jsx("td",{colSpan:b.length,className:"p-4 text-center",children:e.jsx(n.Spinner,{className:"h-10 w-10",color:"green"})})}):w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:b.length,className:"p-4 text-center text-red-500",children:e.jsxs("div",{className:"flex justify-center items-center gap-2",children:["No customer disconnection records found",e.jsx(Q,{className:"text-xl"})]})})}):w.map(({id:s,customer_name:a,sex:o,address:i,contact_no:j,disconnection:y,status:f})=>e.jsxs("tr",{className:"hover:bg-blue-gray-50",children:[e.jsx("td",{className:"border text-sm px-2 py-2",children:s}),e.jsx("td",{className:"border text-sm px-2 py-2",children:a}),e.jsx("td",{className:"border text-sm px-2 py-2",children:o}),e.jsx("td",{className:"border text-sm px-2 py-2",children:i}),e.jsx("td",{className:"border text-sm px-2 py-2",children:j}),e.jsx("td",{className:"border text-sm px-2 py-2",children:y}),e.jsx("td",{className:"border text-sm px-2 py-2",children:f}),e.jsx("td",{className:"border px-4",children:e.jsxs(n.Menu,{children:[e.jsx(n.MenuHandler,{children:e.jsx(n.IconButton,{variant:"text",children:e.jsx(n.Tooltip,{content:"Actions",children:e.jsx("img",{src:"/img/dots.png",alt:"actions"})})})}),e.jsxs(n.MenuList,{children:[e.jsx(N,{href:route("disconnections.show",{id:s}),children:e.jsx(n.MenuItem,{children:"View"})}),e.jsx(N,{href:route("disconnections.edit",{id:s}),children:e.jsx(n.MenuItem,{children:"Edit"})}),e.jsx(n.MenuItem,{onClick:()=>U(s),children:"Delete"})]})]})})]},s))})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center border-t p-4",children:[e.jsxs("div",{className:"col-span-1",children:["Page ",t==null?void 0:t.current_page," of ",t==null?void 0:t.last_page]}),e.jsxs("div",{className:"col-span-2 flex flex-col items-center",children:[e.jsx(W,{currentPage:(t==null?void 0:t.current_page)||1,lastPage:(t==null?void 0:t.last_page)||1,onPageChange:L}),e.jsxs("div",{className:"mt-3 text-gray-700",children:["Showing ",(h-1)*10+1," to"," ",Math.min(h*10,t==null?void 0:t.total)," of ",t==null?void 0:t.total," entries"]})]})]})]})]})]})};export{re as default};
